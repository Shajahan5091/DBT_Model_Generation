version: 2

models:
  - name: DimCustomer
    description: Customer dimension table containing customer details including contact information and location data
    columns:
      - name: customer_id
        description: Unique identifier for each customer
        tests:
          - unique
          - not_null
      - name: full_name
        description: Concatenated full name of the customer combining first name and last name
      - name: email
        description: Email address of the customer
      - name: phone
        description: Phone number of the customer
      - name: city
        description: City where the customer is located, looked up based on customer_id
      - name: state
        description: State where the customer is located, looked up based on customer_id
      - name: country
        description: Country where the customer is located, looked up based on customer_id
      - name: is_current
        description: Boolean flag indicating if customer is active, true only if created_ts is less than 2 years from current date

  - name: DimProduct
    description: Product dimension table containing product details including brand, category, pricing and availability information
    columns:
      - name: product_id
        description: Unique identifier for each product
        tests:
          - unique
          - not_null
      - name: product_name
        description: Name of the product
      - name: brand
        description: Brand name of the product
      - name: category_name
        description: Category name of the product, looked up based on product_category_id
      - name: current_unit_price
        description: Current unit price of the product after applying discount percentage from Product_Discount table
      - name: active_flag
        description: Boolean flag indicating if product is active based on quantity_on_hand, false if quantity is zero, true otherwise

  - name: FactInventorySnapshot
    description: Fact table capturing daily inventory snapshots showing product quantities at each warehouse
    columns:
      - name: snapshot_date
        description: Date of the inventory snapshot, set to current date
        tests:
          - not_null
      - name: product_id
        description: Foreign key reference to the product
        tests:
          - not_null
      - name: warehouse_id
        description: Foreign key reference to the warehouse
        tests:
          - not_null
      - name: quantity_on_hand
        description: Quantity of product available in the warehouse at snapshot date

  - name: FactPayment
    description: Fact table containing payment transaction details for orders
    columns:
      - name: order_id
        description: Foreign key reference to the order
        tests:
          - not_null
      - name: payment_method
        description: Method used for payment
      - name: amount_paid
        description: Total amount paid for the order
      - name: payment_date
        description: Date when the payment was made, converted from payment timestamp

  - name: FactReturns
    description: Fact table tracking product returns with return reasons and associated order line details
    columns:
      - name: return_date
        description: Date when the product was returned
        tests:
          - not_null
      - name: order_line_id
        description: Foreign key reference to the order line item being returned
        tests:
          - not_null
      - name: product_id
        description: Foreign key reference to the product being returned, looked up from Order_Line based on order_line_id
      - name: return_reason
        description: Reason provided for the product return

  - name: FactSales
    description: Fact table containing sales transaction details with quantity, pricing and discount information
    columns:
      - name: order_date
        description: Date when the order was placed
        tests:
          - not_null
      - name: customer_id
        description: Foreign key reference to the customer who placed the order
        tests:
          - not_null
      - name: product_id
        description: Foreign key reference to the product sold
        tests:
          - not_null
      - name: order_id
        description: Foreign key reference to the order
        tests:
          - not_null
      - name: order_line_id
        description: Unique identifier for each order line item
        tests:
          - unique
          - not_null
      - name: quantity_sold
        description: Quantity of product sold in the order line
      - name: gross_amount
        description: Gross sales amount calculated as quantity multiplied by unit price
      - name: discount_amount
        description: Discount amount calculated as unit price multiplied by discount percentage
      - name: net_amount
        description: Net sales amount calculated as gross amount minus discount amount

  - name: FactShipment
    description: Fact table tracking shipment details including shipping and delivery dates and status
    columns:
      - name: order_id
        description: Foreign key reference to the order being shipped
        tests:
          - not_null
      - name: shipped_date
        description: Date when the order was shipped
      - name: delivery_date
        description: Date when the order was delivered
      - name: status
        description: Current status of the shipment