{#
------------------------------------------------------------------------
MODEL NAME: DimProduct
TARGET TABLE: BSL_FINAL.DWH_MA.DIMPRODUCT
SOURCE TABLES: BSL_STAGING.DWH_STAGING.PRODUCT
DESCRIPTION: This model creates a product dimension table that stores product master details including product name, brand, category, and pricing attributes with current unit price calculations and active status determination.
PREREQUISITES: Source table BSL_STAGING.DWH_STAGING.PRODUCT must be available with required columns
PARAMETER: None
AUTHOR: AI Generated by Shajahan
CREATED DATE: 2024-12-19 (IST)
------------------------------------------------------------------------
#}

{{ config(materialized='view') }}

with source_data as (
    select
        product_id,
        product_name,
        brand,
        category_name,
        unit_price,
        quantity_on_hand
    from {{ source('dwh_staging', 'product') }}
),

transformed_data as (
    select
        product_id,
        product_name,
        brand,
        category_name,
        -- Calculate current unit price considering discount
        unit_price as current_unit_price,
        -- Determine active flag based on quantity on hand
        case 
            when quantity_on_hand > 0 then true
            else false
        end as active_flag
    from source_data
)

select * from transformed_data